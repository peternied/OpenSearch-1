/*
 * SPDX-License-Identifier: Apache-2.0
 *
 * The OpenSearch Contributors require contributions made to
 * this file be licensed under the Apache-2.0 license or a
 * compatible open source license.
 */

apply plugin: 'opensearch.internal-cluster-test'

opensearchplugin {
  description 'Plugin for identity features in OpenSearch.'
  classname 'org.opensearch.identity.DefaultIdentityPlugin'
  name project.name
  licenseFile rootProject.file('licenses/APACHE-LICENSE-2.0.txt')
  noticeFile rootProject.file('NOTICE.txt')
}

dependencies {
  implementation 'org.apache.shiro:shiro-core:1.9.1'
  // Needed for shiro
  implementation "org.slf4j:slf4j-api:${versions.slf4j}"

  implementation 'commons-beanutils:commons-beanutils:1.9.4'
  implementation 'commons-logging:commons-logging:1.2'
  implementation 'commons-lang:commons-lang:2.6'

  implementation "com.fasterxml.jackson.core:jackson-core:${versions.jackson}"
  implementation "com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:${versions.jackson}"
  implementation "com.fasterxml.jackson.core:jackson-annotations:${versions.jackson}"
  implementation "com.fasterxml.jackson.core:jackson-databind:${versions.jackson_databind}"

  implementation "org.bouncycastle:bcprov-jdk15on:${versions.bouncycastle}"

  // implementation 'org.greenrobot:eventbus:3.2.0'

  // implementation ('org.apache.cxf:cxf-rt-rs-security-jose:3.4.5') {
  //   exclude(group: 'jakarta.activation', module: 'jakarta.activation-api')
  // }

  // implementation 'org.apache.cxf:cxf-core:3.4.5'
  // implementation 'org.apache.cxf:cxf-rt-rs-json-basic:3.4.5'
  // implementation 'org.apache.cxf:cxf-rt-security:3.4.5'

  testImplementation project(path: ':modules:transport-netty4') // for http
  testImplementation project(path: ':plugins:transport-nio') // for http
}

tasks.named("dependencyLicenses").configure {
  mapping from: /jackson-.*/, to: 'jackson'
  mapping from: /cxf-.*/, to: 'cxf'
  mapping from: /log4j-.*/, to: 'log4j'
}

//task integTest(type: RestIntegTestTask) {
//  systemProperty 'opensearch.set.netty.runtime.available.processors', 'false'
//}
// TODO move the integ tests into qa module after this is moved out of sandbox?
/*
 * We have to disable setting the number of available processors as tests in the same JVM randomize processors and will step on each
 * other if we allow them to set the number of available processors as it's set-once in Netty.
 */
  test {
    systemProperty 'opensearch.set.netty.runtime.available.processors', 'false'
  }

internalClusterTest {
  systemProperty 'opensearch.set.netty.runtime.available.processors', 'false'
}

thirdPartyAudit.ignoreMissingClasses(
  'android.app.Activity',
  'android.app.AlertDialog$Builder',
  'android.app.Dialog',
  'android.app.DialogFragment',
  'android.app.Fragment',
  'android.app.FragmentManager',
  'android.app.FragmentTransaction',
  'android.content.Context',
  'android.content.DialogInterface',
  'android.content.DialogInterface$OnClickListener',
  'android.content.res.Resources',
  'android.os.Build$VERSION',
  'android.os.Bundle',
  'android.os.Handler',
  'android.os.Looper',
  'android.os.Message',
  'android.os.SystemClock',
  'android.support.v4.app.DialogFragment',
  'android.support.v4.app.Fragment',
  'android.support.v4.app.FragmentActivity',
  'android.support.v4.app.FragmentManager',
  'android.support.v4.app.FragmentTransaction',
  'android.util.Log',
  'javax.servlet.ServletContextEvent',
  'javax.servlet.ServletContextListener',
  'org.apache.avalon.framework.logger.Logger',
  'org.apache.commons.configuration2.interpol.ConfigurationInterpolator',
  'org.apache.commons.collections.Closure',
  'org.apache.commons.collections.FastHashMap',
  'org.apache.commons.collections.Predicate',
  'org.apache.commons.collections.Transformer',
  'org.apache.commons.collections.comparators.ComparableComparator',
  'org.apache.commons.collections.keyvalue.AbstractMapEntry',
  'org.apache.log.Hierarchy',
  'org.apache.log.Logger',
  'org.apache.log4j.Level',
  'org.apache.log4j.Logger',
  'org.apache.log4j.Priority',
  'com.ctc.wstx.msv.W3CSchema',
  'org.slf4j.impl.StaticLoggerBinder',
  'org.slf4j.impl.StaticMDCBinder',
  'org.slf4j.impl.StaticMarkerBinder',
  'com.sun.msv.grammar.xmlschema.XMLSchemaGrammar',
  'com.sun.msv.grammar.xmlschema.XMLSchemaSchema',
  'com.sun.msv.reader.GrammarReaderController',
  'com.sun.msv.reader.State',
  'com.sun.msv.reader.xmlschema.MultiSchemaReader',
  'com.sun.msv.reader.xmlschema.SchemaState',
  'com.sun.msv.reader.xmlschema.XMLSchemaReader',
  'com.sun.msv.reader.xmlschema.XMLSchemaReader$StateFactory',
  'com.sun.xml.bind.marshaller.NamespacePrefixMapper',
  'com.sun.xml.fastinfoset.stax.StAXDocumentParser',
  'com.sun.xml.fastinfoset.stax.StAXDocumentSerializer',
  'javax.activation.CommandInfo',
  'javax.activation.CommandMap',
  'javax.activation.DataContentHandler',
  'javax.activation.DataHandler',
  'javax.activation.DataSource',
  'javax.activation.FileDataSource',
  'javax.activation.MailcapCommandMap',
  'javax.annotation.PostConstruct',
  'javax.annotation.PreDestroy',
  'javax.annotation.Resource',
  'javax.annotation.Resources',
  'javax.validation.Configuration',
  'javax.validation.ConstraintValidatorFactory',
  'javax.validation.ConstraintViolationException',
  'javax.validation.MessageInterpolator',
  'javax.validation.ParameterNameProvider',
  'javax.validation.TraversableResolver',
  'javax.validation.Validation',
  'javax.validation.ValidationProviderResolver',
  'javax.validation.Validator',
  'javax.validation.ValidatorFactory',
  'javax.validation.bootstrap.GenericBootstrap',
  'javax.validation.bootstrap.ProviderSpecificBootstrap',
  'javax.validation.executable.ExecutableType',
  'javax.validation.executable.ExecutableValidator',
  'javax.validation.executable.ValidateOnExecution',
  'javax.validation.metadata.BeanDescriptor',
  'javax.validation.metadata.MethodDescriptor',
  'javax.xml.bind.DatatypeConverter',
  'javax.xml.bind.JAXBContext',
  'javax.xml.bind.JAXBElement',
  'javax.xml.bind.JAXBException',
  'javax.xml.bind.Marshaller',
  'javax.xml.bind.SchemaOutputResolver',
  'javax.xml.bind.Unmarshaller',
  'javax.xml.bind.annotation.XmlElement',
  'javax.xml.bind.annotation.XmlElementDecl',
  'javax.xml.bind.annotation.XmlElementDecl$GLOBAL',
  'javax.xml.bind.annotation.XmlRootElement',
  'javax.xml.bind.annotation.XmlSchema',
  'javax.xml.bind.annotation.XmlType',
  'javax.xml.bind.attachment.AttachmentMarshaller',
  'javax.xml.bind.attachment.AttachmentUnmarshaller',
  'javax.xml.ws.WebServiceFeature',
  'net.sf.cglib.proxy.Enhancer',
  'net.sf.cglib.proxy.MethodInterceptor',
  'net.sf.cglib.proxy.MethodProxy',
  'org.apache.aries.blueprint.ComponentDefinitionRegistry',
  'org.apache.aries.blueprint.ExtendedBeanMetadata',
  'org.apache.aries.blueprint.NamespaceHandler',
  'org.apache.aries.blueprint.ParserContext',
  'org.apache.aries.blueprint.PassThroughMetadata',
  'org.apache.aries.blueprint.mutable.MutableBeanMetadata',
  'org.apache.aries.blueprint.mutable.MutableCollectionMetadata',
  'org.apache.aries.blueprint.mutable.MutablePassThroughMetadata',
  'org.apache.aries.blueprint.mutable.MutableRefMetadata',
  'org.apache.aries.blueprint.mutable.MutableValueMetadata',
  'org.apache.aries.blueprint.services.ExtendedBlueprintContainer',
  'org.apache.ws.commons.schema.XmlSchema',
  'org.apache.ws.commons.schema.XmlSchemaAll',
  'org.apache.ws.commons.schema.XmlSchemaAnnotated',
  'org.apache.ws.commons.schema.XmlSchemaAttribute',
  'org.apache.ws.commons.schema.XmlSchemaAttributeGroupRef',
  'org.apache.ws.commons.schema.XmlSchemaChoice',
  'org.apache.ws.commons.schema.XmlSchemaCollection',
  'org.apache.ws.commons.schema.XmlSchemaComplexContentExtension',
  'org.apache.ws.commons.schema.XmlSchemaComplexContentRestriction',
  'org.apache.ws.commons.schema.XmlSchemaComplexType',
  'org.apache.ws.commons.schema.XmlSchemaContentModel',
  'org.apache.ws.commons.schema.XmlSchemaElement',
  'org.apache.ws.commons.schema.XmlSchemaEnumerationFacet',
  'org.apache.ws.commons.schema.XmlSchemaExternal',
  'org.apache.ws.commons.schema.XmlSchemaForm',
  'org.apache.ws.commons.schema.XmlSchemaImport',
  'org.apache.ws.commons.schema.XmlSchemaObject',
  'org.apache.ws.commons.schema.XmlSchemaParticle',
  'org.apache.ws.commons.schema.XmlSchemaSequence',
  'org.apache.ws.commons.schema.XmlSchemaSimpleContentExtension',
  'org.apache.ws.commons.schema.XmlSchemaSimpleContentRestriction',
  'org.apache.ws.commons.schema.XmlSchemaSimpleType',
  'org.apache.ws.commons.schema.XmlSchemaSimpleTypeRestriction',
  'org.apache.ws.commons.schema.XmlSchemaType',
  'org.apache.ws.commons.schema.constants.Constants',
  'org.apache.ws.commons.schema.extensions.ExtensionRegistry',
  'org.apache.ws.commons.schema.extensions.ExtensionSerializer',
  'org.apache.ws.commons.schema.resolver.URIResolver',
  'org.apache.ws.commons.schema.utils.NamespaceMap',
  'org.apache.ws.commons.schema.utils.NamespacePrefixList',
  'org.apache.ws.commons.schema.utils.XmlSchemaRef',
  'org.apache.xml.resolver.Catalog',
  'org.apache.xml.resolver.CatalogManager',
  'org.apache.xml.resolver.helpers.Debug',
  'org.apache.xml.resolver.tools.CatalogResolver',
  'org.codehaus.stax2.XMLStreamReader2',
  'org.codehaus.stax2.XMLStreamWriter2',
  'org.codehaus.stax2.validation.ValidationProblemHandler',
  'org.codehaus.stax2.validation.XMLValidationProblem',
  'org.codehaus.stax2.validation.XMLValidationSchema',
  'org.objectweb.asm.ClassWriter',
  'org.osgi.framework.Bundle',
  'org.osgi.framework.BundleActivator',
  'org.osgi.framework.BundleContext',
  'org.osgi.framework.BundleEvent',
  'org.osgi.framework.FrameworkUtil',
  'org.osgi.framework.ServiceReference',
  'org.osgi.framework.ServiceRegistration',
  'org.osgi.framework.SynchronousBundleListener',
  'org.osgi.framework.Version',
  'org.osgi.service.blueprint.container.BlueprintContainer',
  'org.osgi.service.blueprint.container.Converter',
  'org.osgi.service.blueprint.container.ReifiedType',
  'org.osgi.service.blueprint.reflect.BeanMetadata',
  'org.osgi.service.blueprint.reflect.BeanProperty',
  'org.osgi.service.blueprint.reflect.CollectionMetadata',
  'org.osgi.service.blueprint.reflect.ComponentMetadata',
  'org.osgi.service.blueprint.reflect.MapMetadata',
  'org.osgi.service.blueprint.reflect.Metadata',
  'org.osgi.service.blueprint.reflect.RefMetadata',
  'org.osgi.service.blueprint.reflect.ValueMetadata',
  'org.osgi.service.cm.Configuration',
  'org.osgi.service.cm.ConfigurationAdmin',
  'org.osgi.service.cm.ManagedServiceFactory',
  'org.osgi.util.tracker.ServiceTracker',
  'org.springframework.aop.TargetSource',
  'org.springframework.aop.framework.Advised',
  'org.springframework.aop.support.AopUtils',
  'org.springframework.beans.Mergeable',
  'org.springframework.beans.MutablePropertyValues',
  'org.springframework.beans.PropertyValue',
  'org.springframework.beans.factory.BeanFactory',
  'org.springframework.beans.factory.FactoryBean',
  'org.springframework.beans.factory.config.BeanDefinition',
  'org.springframework.beans.factory.config.BeanDefinitionHolder',
  'org.springframework.beans.factory.config.BeanFactoryPostProcessor',
  'org.springframework.beans.factory.config.BeanPostProcessor',
  'org.springframework.beans.factory.config.ConfigurableListableBeanFactory',
  'org.springframework.beans.factory.config.ConstructorArgumentValues',
  'org.springframework.beans.factory.config.DestructionAwareBeanPostProcessor',
  'org.springframework.beans.factory.config.TypedStringValue',
  'org.springframework.beans.factory.support.AbstractBeanDefinition',
  'org.springframework.beans.factory.support.AbstractBeanFactory',
  'org.springframework.beans.factory.support.BeanDefinitionBuilder',
  'org.springframework.beans.factory.support.BeanDefinitionReaderUtils',
  'org.springframework.beans.factory.support.BeanDefinitionRegistry',
  'org.springframework.beans.factory.support.DefaultListableBeanFactory',
  'org.springframework.beans.factory.support.RootBeanDefinition',
  'org.springframework.beans.factory.wiring.BeanConfigurerSupport',
  'org.springframework.beans.factory.wiring.BeanWiringInfo',
  'org.springframework.beans.factory.wiring.BeanWiringInfoResolver',
  'org.springframework.beans.factory.xml.AbstractBeanDefinitionParser',
  'org.springframework.beans.factory.xml.AbstractSingleBeanDefinitionParser',
  'org.springframework.beans.factory.xml.BeanDefinitionParserDelegate',
  'org.springframework.beans.factory.xml.DefaultDocumentLoader',
  'org.springframework.beans.factory.xml.DelegatingEntityResolver',
  'org.springframework.beans.factory.xml.NamespaceHandlerResolver',
  'org.springframework.beans.factory.xml.NamespaceHandlerSupport',
  'org.springframework.beans.factory.xml.ParserContext',
  'org.springframework.beans.factory.xml.XmlBeanDefinitionReader',
  'org.springframework.context.ApplicationContext',
  'org.springframework.context.ApplicationContextAware',
  'org.springframework.context.ApplicationEvent',
  'org.springframework.context.ApplicationListener',
  'org.springframework.context.ConfigurableApplicationContext',
  'org.springframework.context.support.AbstractApplicationContext',
  'org.springframework.context.support.ClassPathXmlApplicationContext',
  'org.springframework.core.Ordered',
  'org.springframework.core.io.Resource',
  'org.springframework.core.io.UrlResource',
  'org.springframework.core.io.support.EncodedResource',
  'org.springframework.core.io.support.PathMatchingResourcePatternResolver',
  'org.springframework.core.io.support.PropertiesLoaderUtils',
  'org.springframework.core.io.support.ResourcePatternResolver',
  'org.springframework.core.type.AnnotationMetadata',
  'org.springframework.core.type.classreading.MetadataReader',
  'org.springframework.core.type.classreading.MetadataReaderFactory',
  'org.springframework.osgi.util.BundleDelegatingClassLoader',
  'org.springframework.util.ClassUtils',
  'org.springframework.util.CollectionUtils',
)
